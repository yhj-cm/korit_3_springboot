
# ì…ì‹¤ ì²´í¬ í•´ì£¼ì„¸ìš” !! ğŸš“
# 5ì›” ìê²©ì¦ ì‹œí—˜ì´ ìˆëŠ” ë¶„ë“¤ì´ ìˆìŠµë‹ˆë‹¤.
## CRUD ë¦¬í¬ì§€í† ë¦¬ ìƒì„±
- ìŠ¤í”„ë§ ë°ì´í„° JPA CRUD ì‘ì—…ì„ ìœ„í•œ CrudRepository ì¸í„°í˜ì´ìŠ¤ê°€ ì¡´ì¬.
    - ì´ìƒì˜ ì¸í„°í˜ì´ìŠ¤ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì— CRUD ê¸°ëŠ¥ì„ ì œê³µ.

1. domain íŒ¨í‚¤ì§€ì— CarRepository ì¸í„°í˜ì´ìŠ¤ ìƒì„±.
    - ì´í•˜ì˜ ì½”ë“œ ì‘ì„±
```java
package com.packt.cardatabase.domain;

import org.springframework.data.repository.CrudRepository;

public interface CarRepository extends CrudRepository<Car, Long> {}
```
ì´ìƒì˜ extendsë¥¼ ëª…ë ¹ì–´ë¥¼ ì ìš©í•˜ê²Œ ë˜ë©´ ì´ì œ CarRepositoryëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸
JPAì˜ CrudRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°”íƒ•ìœ¼ë¡œ í™•ì¥ëœ ì¸í„°í˜ì´ìŠ¤ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`<Car, Long>` íƒ€ì…ì˜ arugmentëŠ” Car ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ë¦¬í¬ì§€í† ë¦¬ì´ê³  ID í•„ë“œì˜
íƒ€ì…ì´ Long ìë£Œí˜•ì„(not long)ì„ ì •ì˜í–ˆìŠµë‹ˆë‹¤.

CrudRepository ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ì–‘í•œ CRUD ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ”ë°,
SQLë¬¸ê³¼ì˜ ë¹„êµë¥¼ ìƒê°í•˜ì‹¤ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

### CRUD ë©”ì„œë“œ
1. long count()
    - ì—”í‹°í‹°ì˜ ìˆ˜ë¥¼ ë°˜í™˜
2. Iterable<T> findAll()
    - ì§€ì •í•œ íƒ€ì…ì˜ ëª¨ë“  í•­ëª©ì„ ë°˜í™˜(Iterableì€ ë°˜ë³µ ê°€ëŠ¥ ê°ì²´ë¥¼ ì˜ë¯¸í•¨ - ë°°ì—´/Collection ë“±)
3. Optional<T> findById(ID id)
    - ì§€ì •í•œ IDì˜ í•œ í•­ëª©ì„ ë°˜í™˜
4. void delete(T entity)
    - ì—”í‹°í‹° ì‚­ì œ
5. void deleteAll()
    - ë¦¬í¬ì§€í† ë¦¬ì˜ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ì‚­ì œ
6. `<S extends T> save(S entity)`
    - ì—”í‹°í‹°ë¥¼ ì €ì¥
      `7. List<S> saveAll(Iterable<S> entities)`
    - ì—¬ëŸ¬ ì—”í‹°í‹°ë¥¼ ì €ì¥

ë©”ì„œë“œê°€ í•œ í•­ëª©ë§Œ ë°˜í™˜í•  ë•ŒëŠ” T ëŒ€ì‹ ì— Optional<T>ë¥¼ ë°˜í™˜. Optional í´ë˜ìŠ¤ëŠ” Java8SE
ì—ì„œ ë„ì…ëœ íƒ€ì…ìœ¼ë¡œ, ê°’ì„ í¬í•¨í•˜ê±°ë‚˜ í¬í•¨í•˜ì§€ ì•ŠëŠ” ë‹¨ì¼ ê°’ ì»¨í…Œì´ë„ˆì— í•´ë‹¹.
ê°’ì´ ìˆìœ¼ë©´ isPresent() ë©”ì„œë“œê°€ trueë¥¼ ë°˜í™˜í•˜ê³ , ì—†ìœ¼ë©´ falseë¥¼ ë°˜í™˜í•¨.
ê°’ì´ ìˆìœ¼ë©´ get() ë©”ì„œë“œë¥¼ í†µí•´ ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŒ.

ì´ìƒì˜ ê³¼ì •ì„ ê±°ì¹˜ëŠ” ì´ìœ  â†’ Optionalì„ ì´ìš©í•˜ë©´ null pointer exceptionì„ ë°©ì§€ ê°€ëŠ¥.

2. H2 ë°ì´í„°ë² ì´ìŠ¤ì—(í˜„ì¬ëŠ” ì•„ë¬´ëŸ° ê°’ì´ ì—†ìŠµë‹ˆë‹¤) ì˜ˆì œ ë°ì´í„°ë¥¼ ì¶”ê°€. ì´ë¥¼ ìœ„í•´ì„œëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸
   `CommandLineRunner` ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš© ê°€ëŠ¥. ì´ë¥¼ ì‚¬ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì™„ì „íˆ ì‹œì‘ë˜ê¸° ì „ì—
   ì¶”ê°€ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ì˜ˆì œ ë°ì´í„°(ì¦‰ í…ŒìŠ¤íŠ¸ ìš©)ë¥¼ ì¤€ë¹„í•˜ê¸°ì— ì í•©í•¨. ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜
   main í´ë˜ìŠ¤ëŠ” CommandLineRunner ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

   CardataApplicationì½”ë“œì— run ë©”ì„œë“œë¥¼ êµ¬í˜„í• ê²ë‹ˆë‹¤.

```java
package com.packt.cardatabase;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class CardatabaseApplication implements CommandLineRunner {
	private static final Logger logger = LoggerFactory.getLogger(CardatabaseApplication.class);

	public static void main(String[] args) {
		SpringApplication.run(CardatabaseApplication.class, args);
		logger.info("ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰");
	}

	@Override
	public void run(String... args) throws Exception {
		
	}
}
```
ì´ìƒì˜ ì½”ë“œëŠ” 2. ê³¼ì •ì„ ì™„ë£Œí•œ ë¶€ë¶„ê¹Œì§€ì…ë‹ˆë‹¤. ê¹ƒí—ˆë¸Œë¡œ í•™ìŠµí•˜ì‹œëŠ” ë¶„ë“¤ì˜ ê²½ìš°ëŠ” ì§€ì‹œ ì‚¬í•­ëŒ€ë¡œ ì‘ì„±í•´ë³´ê³ 
ì™œ ë»˜ê±´ ì¤„ ëœ¨ëŠ”ì§€, ê·¸ë¦¬ê³  ê·¸ê²ƒì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ ìš°ë¦¬ê°€ ì˜ˆì „ì— ì–´ë–»ê²Œ ìˆ˜ì—…ì„ í–ˆì—ˆëŠ”ì§€ì— ëŒ€í•´ ì£¼ëª©í•  í•„ìš”ê°€
ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ implements CommandLineRunnerë¥¼ ì‘ì„±í•˜ê²Œ ë˜ë©´, ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë¼ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ëœ°ê²ë‹ˆë‹¤.
ê·¸ë¦¬ê³  ì¸í„°í˜ì´ìŠ¤ëŠ” ì¶”ìƒ ë©”ì„œë“œë“¤ì„ ìƒì†ë°›ëŠ” ì„œë¸Œ í´ë˜ìŠ¤ë“¤ì— êµ¬í˜„í•˜ê²Œë” ê°•ì œí•©ë‹ˆë‹¤.
ê·¸ë˜ì„œ ë¹¨ê°„ ì¤„ ì»¤ì„œ â†’ implement methods â†’ í´ë¦­ê¹Œì§€í•˜ì‹œê²Œ ë˜ë©´ ì´ìƒì˜ ì½”ë“œë¸”ëŸ­ìœ¼ë¡œ ì™„ì„±ëœë‹¤ëŠ” ì ì—
ì£¼ëª©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

3. ìë™ì°¨ ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ìˆ˜ ìˆë„ë¡ CarRepositoryë¥¼ main í´ë˜ìŠ¤ì— ì£¼ì…(DIê°œë…ì€ ì´í‹€ ì „ì— í•™ìŠµí•¨).
   ìƒì„±ì ì£¼ì…ì„ í†µí•´ CarRepositoryë¥¼ ì£¼ì…. ê·¸ë¦¬ê³  Logger ì¶”ê°€(ì´ë¯¸í–ˆìŠµë‹ˆë‹¤.)
```java
 package com.packt.cardatabase;

import com.packt.cardatabase.domain.CarRepository;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import com.packt.cardatabase.domain.Car;
import com.packt.cardatabase.domain.CarRepository;

@SpringBootApplication
public class CardatabaseApplication implements CommandLineRunner {
    private static final Logger logger = LoggerFactory.getLogger(CardatabaseApplication.class);

    // ì—¬ê¸°ì„œëŠ” CardatabaseApplicationì˜ í•„ë“œë¡œ repository ì„ ì–¸
    private final CarRepository repository;
    // ìƒì„±ì ì£¼ì…ì„ í†µí•œ CarRepository
    public CardatabaseApplication(CarRepository repository) {
        this.repository = repository;
    }

    public static void main(String[] args) {
        SpringApplication.run(CardatabaseApplication.class, args);
        logger.info("ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰");
    }

    @Override
    public void run(String... args) throws Exception {
        repository.save(new Car("Ford", "Mustang", "Red", "ADF-11121", 2023, 59000));
        repository.save(new Car("Nissan", "Leaf", "White", "SSJ-3002", 2020, 29000));
        repository.save(new Car("Toyota", "Prius", "Silver", "KKO-0212", 2022, 39000));
        repository.save(new Car("Kia", "Seltos", "Chacoal", "360ìˆ˜5690", 2020, 28000));

        // ëª¨ë“  ìë™ì°¨ ì—”í‹°í‹°ë¥¼ ë‹¤ ì°¾ì•„ë‚´ì„œ Consoleì°½ì— ë¡œê¹…
        for (Car car : repository.findAll()) {
            logger.info("ë¸Œëœë“œ: {}, ëª¨ë¸ëª…: {}", car.getBrand(), car.getModel());
        }
    }
}
```
4. ì´ìƒì˜ ì½”ë“œë¥¼ í†µí•´ CarRepository í´ë˜ìŠ¤(ì¸í„°í˜ì´ìŠ¤)ë¥¼ ì£¼ì…í•˜ê³  run ë©”ì„œë“œì—ì„œ CRUD ë©”ì„œë“œ ì´ìš© ê°€ëŠ¥.
   .save() ë©”ì„œë“œë¥¼ í†µí•´ ì—¬ëŸ¬ ìë™ì°¨ ë°ì´í„°ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤(Car ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë°©ì‹ì€ Car í´ë˜ìŠ¤ì—ì„œ í™•ì¸ ê°€ëŠ¥)
   ë˜í•œ .findAll() ë©”ì„œë“œì˜ ì‚¬ìš©ìœ¼ë¡œ Iterable íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ëœ ì „ì²´ Car ë°ì´í„°ë¥¼
   í–¥ìƒëœ forë¬¸ì„ í†µí•´ ê°ê°ì˜ Car ì¸ìŠ¤í„´ìŠ¤ì˜ brandì™€ modelì„ consoleì— ì¶œë ¥í•˜ëŠ” ê³¼ì •ì„ ê±°ì³¤ìŠµë‹ˆë‹¤.
   ë˜í•œ, h2-consoleì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
   http://localhost:8080/h2-console


- ìŠ¤í”„ë§ ë°ì´í„° ë¦¬í¬ì§€í† ë¦¬ì— ì¿¼ë¦¬(ì¿¼ë¦¬=/=SQL)ë„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¿¼ë¦¬ì— í•´ë‹¹í•˜ëŠ” ë©”ì„œë“œëŠ” ê·œì •ë˜ì–´ìˆê³ 
  (ì˜ˆ- findBy ë“±), ê·¸ ë‹¤ìŒ ì¿¼ë¦¬ì— ì‚¬ìš©í•  ì—”í‹°í‹° í´ë˜ìŠ¤ í•„ë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤(Car ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ê³ ë ¤í•˜ìë©´
  findByBrand ë“±) ì˜ˆì‹œë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

```java
package com.packt.cardatabase.domain;

import org.springframework.data.repository.CrudRepository;

import java.util.List;

public interface CarRepository extends CrudRepository<Car, Long> {
    // ë¸Œëœë“œë¡œ ìë™ì°¨ ê²€ìƒ‰
    @Query("select c from Car c where c.brand=?1")
    List<Car> findByBrand(String brand);
    
    // ìƒ‰ìƒìœ¼ë¡œ ìë™ì°¨ ê²€ìƒ‰
    List<Car> findByColor(String color);
    
    // ìë™ì°¨ ìƒì‚°ë…„ë„ë¥¼ í†µí•´ ìë™ì°¨ë¥¼ ê²€ìƒ‰í•œë‹¤ë©´ ì–´ë–»ê²Œ ì¶”ìƒ ë©”ì„œë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œìš”?
    List<Car> findByModelYear(int modelYear);
    
    //By í‚¤ì›Œë“œ ë‹¤ìŒì— And / Or í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì„œ ì—¬ëŸ¬ í•„ë“œë¥¼ ê°€ì§€ê³  ê²€ìƒ‰í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

    // ë¸Œëœë“œì™€ ëª¨ë¸ë¡œ ìë™ì°¨ë¥¼ ê²€ìƒ‰
    List<Car> findByBrandAndModel(String brand, String model);

    // ë¸Œëœë“œ ë˜ëŠ” ìƒ‰ìƒë³„ë¡œ ìë™ì°¨ ê°€ì ¸ì˜¤ê¸°
    List<Car> findByBrandOrColor(String brand, String color);
    
    // ì¿¼ë¦¬ ì •ë ¬ì„ ìœ„í•´ 'ì¿¼ë¦¬ ë©”ì„œë“œ'ì— OrderBy í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // ë¸Œëœë“œë¡œ ìë™ì°¨ë¥¼ ê²€ìƒ‰í•˜ê³  ì—°ë„ë¡œ ì •ë ¬
    List<Car> findByBrandOrderByModelYearAsc(String brand);
    
    // @Query ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©í•˜ë©´ SQLë¬¸ìœ¼ë¡œ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    // @Query ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ likeì™€ ê°™ì€ ê³ ê¸‰ í‘œí˜„ì‹ë„ ì‚¬ìš© ê°€ëŠ¥.
    // SQLë¬¸ì„ ì´ìš©í•˜ì—¬ ë¸Œëœë“œë¡œ ìë™ì°¨ë¥¼ ê²€ìƒ‰(ê·¼ë° LIKE ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ)
    @Query("select c from Car c where c.brand like %1")
    List<Car> findByBrandEndsWith(String brand);
}
```
* @Query ì• ë„ˆí…Œì´ì…˜ì„ ì ìš©í•˜ì—¬ ì½”ë“œì— ì§ì ‘ SQLë¬¸ì„ ì‘ì„±í•˜ê²Œ ë˜ë©´
  ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì— ëŒ€í•œ ì´ì‹ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆì–´ì„œ ì£¼ì˜í•´ì•¼ í•¨.

CarRepository2 ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±

```java
package com.packt.cardatabase.domain;

import org.springframework.data.repository.PagingAndSortingRepository;

public interface CarRepository2 extends PagingAndSortingRepository<Car, Long> {
}

```
ìŠ¤í”„ë§ ë°ì´í„° JPAì—ëŠ” CrudRepositoryë³´ë‹¤ í™•ì¥ëœ PagingAndSortingRepositoryë„ ì œê³µ.
ì´ìƒì˜ í´ë˜ìŠ¤ëŠ” í˜ì´ì§• ë° ì •ë ¬ì„ í†µí•´ ì—”í‹°í‹°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë©”ì„œë“œë¥¼ ì•Œì•„ì„œ ì œê³µí•¨.
ì´ ê²½ìš° ëŒ€ê·œëª¨ ê²°ê³¼ ì§‘í•©ì—ì„œ ëª¨ë“  ë°ì´í„°ë¥¼ ë°˜í™˜í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— í° ì‚¬ì´ì¦ˆì˜
í”„ë¡œì íŠ¸ì—ì„œ ìœ ìš©í•¨.

ì´ ê²½ìš° ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” ë‘ ê°œì˜ ì¶”ê°€ ë©”ì„œë“œë¥¼ ì‚¬ìš© ê°€ëŠ¥(ìœ„ì— ë°°ìš´ê±°ì—ì„œ +@)
1. Iterable<T> findAll(Sort sort)
    - ì§€ì •ëœ ì˜µì…˜ìœ¼ë¡œ ì •ë ¬ëœ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ë°˜í™˜
2. Page<T> findAll(Pageable pageable)
    - ì§€ì •í•œ í˜ì´ì§• ì˜µì…˜ìœ¼ë¡œ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ë°˜í™˜


## í…Œì´ë¸” ê°„ì˜ ê´€ê³„ ì¶”ê°€
- car í…Œì´ë¸”ê³¼ ì¼ëŒ€ë‹¤ ê´€ê³„ì— ìˆëŠ” owner í…Œì´ë¸”ì„ ì¶”ê°€í•  ì˜ˆì •.
- ì´ìƒì—ì„œ ì¼ëŒ€ë‹¤ ê´€ê³„ë¼ëŠ” ì˜ë¯¸ëŠ” ì†Œìœ ìëŠ” ë‹¤ìˆ˜ì˜ ì°¨ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆì§€ë§Œ,
- ì°¨ì˜ ì£¼ì¸ì€ ì†Œìœ ì í•œ ëª… ë°–ì— ì—†ë‹¤ëŠ” ì˜ë¯¸.

1. domain íŒ¨í‚¤ì§€ì— Owner ì—”í‹°í‹° / ë¦¬í¬ì§€í† ë¦¬ ìƒì„± -> ë¦¬í¬ì§€í† ë¦¬ëŠ” CrudRepository
```java
package com.packt.cardatabase.domain;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;

@Entity
public class Owner {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long ownerid;

    private String firstname, lastname;
    // ê¸°ë³¸ ìƒì„±ì / owneridë¥¼ ì œì™¸í•œ RequriedArgsConstructor / Getter / Setter ìƒì„±

    public Owner() {
    }

    public Owner(String firstname, String lastname) {
        this.firstname = firstname;
        this.lastname = lastname;
    }

    public Long getOwnerid() {
        return ownerid;
    }

    public void setOwnerid(Long ownerid) {
        this.ownerid = ownerid;
    }

    public String getFirstname() {
        return firstname;
    }

    public void setFirstname(String firstname) {
        this.firstname = firstname;
    }

    public String getLastname() {
        return lastname;
    }

    public void setLastname(String lastname) {
        this.lastname = lastname;
    }
}


package com.packt.cardatabase.domain;

import org.springframework.data.repository.CrudRepository;

public interface OwnerRepository extends CrudRepository<Owner, Long> {
}
```

3. ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ì„œëŠ” @ManyToOne ë° @OneToMany ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©.
   ì™¸ë˜ í‚¤ë¥¼ í¬í•¨í•œ Car ì—”í‹°í‹° í´ë˜ìŠ¤ì—ì„œëŠ” @ManyToOne ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ ê´€ê³„ ì •ì˜í•´ì•¼ í•¨.
   ê·¸ë¦¬ê³  ì—¬íƒœê¹Œì§€ëŠ” Car ì—”í‹°í‹° í´ë˜ìŠ¤ì— Owner ê´€ë ¨ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— ê±°ê¸°ì— ë§ëŠ”
   í•„ë“œì™€ Getter / Setterë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

   _ëª¨ë“  ì—°ê´€ê´€ê³„ì—ëŠ” FetchType.LAZYë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ_

   ëŒ€ë‹¤(toMany) ê´€ê³„ì˜ ê²½ìš° FetchType.LAZYê°€ ê¸°ë³¸ê°’ì´ë¯€ë¡œ ì •ì˜í•  í•„ìš”ê°€ ì—†ì§€ë§Œ
   ëŒ€ì¼(toOne) ê´€ê³„ì—ëŠ” ë°˜ë“œì‹œ ì •ì˜í•´ì•¼ í•¨.

   FetchTypeì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì „ëµì„ ì •ì˜í•¨. ì§€ì • ê°€ëŠ¥í•œ ê°’ì€
   ì¦‰ì‹œ ê²€ìƒ‰ì„ ì˜ë¯¸í•˜ëŠ” `EAGER` ë˜ëŠ” ì§€ì—° ê²€ìƒ‰ì„ ì˜ë¯¸í•˜ëŠ” `LAZY`ì¼ ìˆ˜ ìˆëŠ”ë°,
   ì˜ˆì œì—ì„œ ì‚¬ìš©í•˜ëŠ” ì§€ì—° ê²€ìƒ‰ì€ ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ ì†Œìœ ìë¥¼ ê²€ìƒ‰í•˜ë©´ 'í•„ìš”í•  ë•Œ' í•´ë‹¹ ì†Œìœ ìì™€
   ì—°ê´€ëœ ëª¨ë“  ìë™ì°¨ë¥¼ ê²€ìƒ‰í•œë‹¤ëŠ” ì˜ë¯¸. ë°˜ë©´ ì¦‰ì‹œ ê²€ìƒ‰ì€ í•´ë‹¹ ì†Œìœ ìì˜ ëª¨ë“  ìë™ì°¨ë¥¼
   'ì¦‰ì‹œ' ê²€ìƒ‰í•œë‹¤ëŠ” ì˜ë¯¸.

4. @OneToManyì• ë„ˆí…Œì´ì…˜ì—ëŠ” cascasde ì†ì„±ì´ ìˆëŠ”ë°, ì´ëŠ” ì‚­ì œ ë° ì—…ë°ì´íŠ¸ ì‹œ
   ì—°ì† íš¨ê³¼ê°€ ì ìš©ë˜ëŠ” ë°©ë²•ì„ ì§€ì •í•¨. ì´ ì†ì„±ì„ ALLë¡œ ì„¤ì •í•˜ê²Œ ë˜ë©´
   ëª¨ë“  ì‘ì—…ì´ ì—°ì†ì ìœ¼ë¡œ ì ìš©ë¨ -> ì˜ˆë¥¼ ë“¤ì–´ ì†Œìœ ìë¥¼ ì‚­ì œí•˜ë©´ ê·¸ ì†Œìœ ìì™€ ì—°ê²°ëœ
   ìë™ì°¨ê°€ í•¨ê»˜ ì‚­ì œë¨.

   mappedBy="owner" ì†ì„±ì€ Car í´ë˜ìŠ¤ ì‚¬ì´ì— ì´ ê´€ê³„ ì™¸ë˜ í‚¤ì¸ owner í•„ë“œê°€
   ì¡´ì¬í•¨ì„ ì•Œë ¤ì¤Œ.

```java
package com.packt.cardatabase.domain;

import jakarta.persistence.*;

import java.util.List;

@Entity
public class Owner {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long ownerid;

    private String firstname, lastname;

    @OneToMany(cascade = CascadeType.ALL, mappedBy = "owner")
    private List<Car> cars;
    // ê¸°ë³¸ ìƒì„±ì / owneridë¥¼ ì œì™¸í•œ RequriedArgsConstructor / Getter / Setter ìƒì„±

    public Owner() {
    }

    public Owner(String firstname, String lastname) {
        this.firstname = firstname;
        this.lastname = lastname;
    }

    public Long getOwnerid() {
        return ownerid;
    }

    public void setOwnerid(Long ownerid) {
        this.ownerid = ownerid;
    }

    public String getFirstname() {
        return firstname;
    }

    public void setFirstname(String firstname) {
        this.firstname = firstname;
    }

    public String getLastname() {
        return lastname;
    }

    public void setLastname(String lastname) {
        this.lastname = lastname;
    }
}
```
ê·¸ëŸ°ë° ì•„ê¹Œ ì „ì— ì–˜ê¸°í–ˆë˜ ê²ƒì²˜ëŸ¼ ìë™ì°¨ì˜ ì†Œìœ ìê°€ ì—¬ëŸ¬ ëª…ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤(ë³´í—˜ ê´€ê³„ë¼ë“ ì§€)

```java
import java.util.HashSet;

// Car.java
@ManyToMany(mappedBy = "cars")
private Set<Owner> owners = new HashSet<>();

public Set<Owner> getOwners() {
    return owners;
}

public void setOwners(Set<Owner> owners) {
    this.owners = owners;
}
```

ì œ ìˆ˜ì—… ìë£Œì—ì„œëŠ” ì¼ëŒ€ë‹¤ / ë‹¤ëŒ€ì¼ ê´€ê³„ë¥¼ ì´ìš©í•˜ê² ì§€ë§Œ ì´ìƒì˜ ì˜ˆì‹œì—ì„œ ë‹¤ëŒ€ë‹¤ë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
ë‹¤ëŒ€ë‹¤ ê´€ê³„ì—ì„œëŠ” Listë³´ë‹¤ëŠ” Setì„ ì´ìš©í•˜ëŠ” í¸ì…ë‹ˆë‹¤.

```java
import java.util.HashSet;

//Owner.java
@ManyToMany(cascade = CascadeType.PERSIST)
@JoinTable(name = "car_owner", joinColumns =
        {
                @JoinColumn(name = "ownerid")}, // owner í…Œì´ë¸”ì˜ PKì¸ ownerid
        inverseJoinColumns = 
        {
                @JoinColumn(name = "id")        // car í…Œì´ë¸”ì˜ PKì¸ id
        }
)
private Set<Car> cars = new HashSet<>();

public Set<Car> getCars() {
    return cars;
}

public void setCars(Set<Car> cars) {
    this.cars = cars;
}
```
@JoinTableì€ ë‘ í…Œì´ë¸” ê°„ì˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ íŠ¹ë³„í•œ ì¢…ë¥˜ì˜ í…Œì´ë¸”ì„ ìƒì„±í•  ë•Œ ì“°ëŠ” ì• ë„ˆí…Œì´ì…˜
ì´ ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ ì¡°ì¸ í…Œì´ë¸”ê³¼ ì¡°ì¸ ì»¬ëŸ¼ì˜ ì´ë¦„ì„ ì„¤ì •í•  ìˆ˜ ìˆìŒ.

## MariaDB ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
0. heidiSQL ì‹¤í–‰
1. Unnamed í™œì„±í™” -> ìš°í´ë¦­ -> ìƒˆë¡œìƒì„±
2. ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ -> ì´ë¦„ cardb
3. cardb ì¼ë‹¨ í™œì„±í™”
4. ì´ì œ build.gradle
```properties
//build.gradle
runtimeOnly 'org.mariadb.jdbc:mariadb-java-client'
```
5. application.properties íŒŒì¼ì— ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì¦‰ H2 ì¸ë©”ëª¨ë¦¬ ì„¤ì •ì„ ì œê±°í•˜ê³ 
   MariaDB ì„¤ì •ì„ ì§‘ì–´ë„£ì–´ì•¼í•˜ëŠ”ë°, ì´ë•Œ ë°ì´í„°ë² ì´ìŠ¤ URL, ì‚¬ìš©ì ì´ë¦„, ì•”í˜¸, ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„ ì„¤ì •
   í•„ìš”í•©ë‹ˆë‹¤.
```properties
spring.datasource.url=jdbc:mariadb://localhost:3306/cardb
spring.datasource.username=root
spring.datasource.password=1234
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=create-drop
```
6. ì´ìƒì˜ propertiesë¥¼ ì°¸ì¡°í•´ì„œ,
    1. spring.jpa.generate-ddl ì„¤ì •ì€ JPAê°€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•´ì•¼í•˜ëŠ”ì§€(true/false)
    2. spring.jpa.ddl-auto ì„¤ì •ì€ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ì˜ ì‘ë™ì„ ì •ì˜
        - none, validate, update, create, create-drop
        - H2ì™€ ê°™ì€ ì„ë² ë””ë“œ(ì¸ë©”ëª¨ë¦¬) ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš° ê¸°ë³¸ê°’ì€ create-drop
        - ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ì´ none
        - create-dropì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±ë˜ê³ , ì¤‘ì§€ë  ë•Œ ì‚­ì œëœë‹¤ëŠ” ì˜ë¯¸.
        - create - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘í•  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸°ë§Œ í•¨.
        - update - ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìŠ¤í‚¤ë§ˆê°€ ë³€ê²½ë˜ë©´ ì—…ë°ì´íŠ¸
        - validate - ì—”í‹°í‹° ë§¤í•‘ ì •ë³´ê°€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì‚¬ë§Œ í•˜ê³ 
          ë‚˜ë¨¸ì§€ DDL(í…Œì´ë¸” ìƒì„±, ìˆ˜ì •, ì‚­ì œ)ëŠ” ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸.
        - ìš´ì˜í™˜ê²½ì—ì„œëŠ” validate / noneì„ ì“°ê³  ê°œë°œ í™˜ê²½ì—ì„œëŠ” create / update ë“±ì„ ì‚¬ìš©í•˜ëŠ” í¸.


# ê³¼ì œ

spring initializrë¥¼ í™œìš©í•˜ì—¬ ë™ì¼í•œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
cardatabase2ë¡œ ì´ë¦„ì§€ì–´ì„œ ë³„ê°œì˜ í”„ë¡œì íŠ¸ë¡œ ìƒì„±í•˜ê³ 
C/ì—¬ëŸ¬ë¶„ì˜ì–´ì´ë¦„/cardatabase/cardatabase2ì— ì½”ë“œë“¤ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ í•˜ì„¸ìš”.
ê·¸ë¦¬ê³  ìƒˆë¡œ ìƒì„±ëœ cardatabase2ì—ëŠ” cardatabaseì˜ ëª¨ë“  íŒŒì¼ë“¤ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ë‚´ì¼ - korit_3_springbootì— ì›ë˜ ìŠ¤í”„ë§ë¶€íŠ¸ í”„ë¡œì íŠ¸ í•˜ë‚˜ë§Œ ìˆì—ˆëŠ”ë° ì±•í„°ë³„ë¡œ ì •ë¦¬í•  ì˜ˆì •
- RESTful API
ì›”ìš”ì¼ - Intellij Ultimateìœ¼ë¡œ ë³€ê²½ ì˜ˆì •

ë‚´ì¼ë§Œ ì±•í„°ë³„ë¡œ í•  ë•Œ ìŠ¤í”„ë§ì´ë‹ˆì…œë¼ì´ì € ì‚¬ìš© ì˜ˆì •ì´ê³  ì±•í„°3ë¶€í„°ëŠ” ê·¸ëƒ¥ ë³µì‚¬í•´ì„œ ë‚˜ëˆ„ê¸°ë§Œ í• ê²ë‹ˆë‹¤.
í˜¹ì‹œ ìŠ¤í”„ë§ë¶€íŠ¸ í”„ë¡œì íŠ¸ ë§Œë“œëŠ” ê²ƒì— ì–´ë ¤ì›€ì´ ìˆë‹¤ë©´ ê¼­ ë‚´ì¼ 1êµì‹œì— ë“¤ì–´ë‘ì‹œê¸° ë°”ëë‹ˆë‹¤.
